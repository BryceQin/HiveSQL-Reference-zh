<!-- TOC  -->
- [0. 窗口定义](#0-窗口定义)
- [1. 分区子句(partition clause)](#1-分区子句partition-clause)
- [2. 排序字句(order clause)](#2-排序字句order-clause)
- [3. 开窗子句(window clause)](#3-开窗子句window-clause)
- [4. 函数(functions)](#4-函数functions)
    - [4.1 聚合函数(Aggregating Functions)](#41-聚合函数aggregating-functions)
        - [4.1.1 count](#411-count)
        - [4.1.2 sum](#412-sum)
        - [4.1.3 min](#413-min)
        - [4.1.4 max](#414-max)
        - [4.1.5 avg](#415-avg)
    - [4.2 窗口函数(Windowing Functions)](#42-窗口函数windowing-functions)
        - [4.2.1 lead](#421-lead)
        - [4.2.2 lag](#422-lag)
        - [4.2.3 first\_value](#423-first_value)
        - [4.2.4 last\_value](#424-last_value)
    - [4.3 分析函数(Analytics Functions)](#43-分析函数analytics-functions)
        - [4.3.1 rank](#431-rank)
        - [4.3.2 row\_number](#432-row_number)
        - [4.3.3 dense\_rank](#433-dense_rank)
        - [4.3.4 cume\_dist](#434-cume_dist)
        - [4.3.5 percent\_rank](#435-percent_rank)
        - [4.3.6 ntile](#436-ntile)
<!-- /TOC -->
# 0. 窗口定义
```sql
语法：
    1.窗口定义包含：分区子句、排序子句、开窗子句和别名等4个元素，所有的4种元素都不是必须的
    2.常用形式：
        functions OVER([partition clause] [order clause] [window clause])
    3.别名形式：
        functions OVER w
        WINDOW w AS ([partition clause] [order clause] [window clause])
        -- 一个查询不允许有两个同名的window
        -- window的定义不可以包含重复依赖
```
# 1. 分区子句(partition clause)
```sql
语法：
    partition by expr [, expr ...]
注意点：
    1. 不能是聚合表达式
    2. 不能包含其他窗口定义中的表达式
```
# 2. 排序字句(order clause)
```sql
语法：
    order by expr [asc | desc] [NULLS FIRST | NULLS LAST] [, expr [asc | desc] [NULLS FIRST | NULLS LAST]...]
注意点：
    1. 与分区子句注意点中要求相同；
    2. 默认为ASC（升序）；
    3. NULL值处理：hive支持指定NULL值排在第一或者排在末尾（2.2.0版本以后）。在hive中，NULL值在升序时排在第一，在降序时排在末尾；
    4. 排序规则（Collating Clause）：hive中不支持指定排序规则。
```
# 3. 开窗子句(window clause)
```sql
语法：
    (ROWS | RANGE) BETWEEN (UNBOUNDED | [num]) PRECEDING AND ([num] PRECEDING | CURRENT ROW | (UNBOUNDED | [num]) FOLLOWING)
    (ROWS | RANGE) BETWEEN CURRENT ROW AND (CURRENT ROW | (UNBOUNDED | [num]) FOLLOWING)
    (ROWS | RANGE) BETWEEN [num] FOLLOWING AND (UNBOUNDED | [num]) FOLLOWING
    -- 当没有指定window clause时，默认的形式是：RANGE BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW
    -- 当没有指定order by和window clause时，默认的形式是：ROW BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING
```
# 4. 函数(functions)
## 4.1 聚合函数(Aggregating Functions)
### 4.1.1 count
### 4.1.2 sum
### 4.1.3 min
### 4.1.4 max
### 4.1.5 avg
## 4.2 窗口函数(Windowing Functions)
### 4.2.1 lead
### 4.2.2 lag
### 4.2.3 first_value
### 4.2.4 last_value
## 4.3 分析函数(Analytics Functions)
### 4.3.1 rank
### 4.3.2 row_number
### 4.3.3 dense_rank
### 4.3.4 cume_dist
### 4.3.5 percent_rank
### 4.3.6 ntile